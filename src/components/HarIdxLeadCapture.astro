---
// HAR IDX Lead Capture Widget Component
export interface Props {
  lang: 'en' | 'es';
  type?: 'contact' | 'property-interest' | 'newsletter';
}

const { lang, type = 'contact' } = Astro.props;

const translations = {
  en: {
    contact: {
      title: 'Get in Touch',
      subtitle: 'Ready to find your dream home? Contact us today!',
      name: 'Full Name',
      email: 'Email Address',
      phone: 'Phone Number',
      message: 'Tell us about your property needs',
      submit: 'Send Message'
    },
    'property-interest': {
      title: 'Property Interest Form',
      subtitle: 'Let us know what you\'re looking for',
      name: 'Full Name',
      email: 'Email Address',
      phone: 'Phone Number',
      propertyType: 'Property Type',
      priceRange: 'Price Range',
      location: 'Preferred Location',
      submit: 'Find My Property'
    },
    newsletter: {
      title: 'Stay Updated',
      subtitle: 'Get the latest property listings and market insights',
      email: 'Email Address',
      submit: 'Subscribe'
    }
  },
  es: {
    contact: {
      title: 'Ponte en Contacto',
      subtitle: '¿Listo para encontrar tu hogar ideal? ¡Contáctanos hoy!',
      name: 'Nombre Completo',
      email: 'Correo Electrónico',
      phone: 'Número de Teléfono',
      message: 'Cuéntanos sobre tus necesidades inmobiliarias',
      submit: 'Enviar Mensaje'
    },
    'property-interest': {
      title: 'Formulario de Interés en Propiedades',
      subtitle: 'Cuéntanos qué estás buscando',
      name: 'Nombre Completo',
      email: 'Correo Electrónico',
      phone: 'Número de Teléfono',
      propertyType: 'Tipo de Propiedad',
      priceRange: 'Rango de Precio',
      location: 'Ubicación Preferida',
      submit: 'Encontrar Mi Propiedad'
    },
    newsletter: {
      title: 'Mantente Actualizado',
      subtitle: 'Recibe los últimos listados de propiedades e información del mercado',
      email: 'Correo Electrónico',
      submit: 'Suscribirse'
    }
  }
};

const t = translations[lang][type];
---

<div class="har-idx-lead-capture bg-white rounded-lg shadow-lg p-6">
  <div class="text-center mb-6">
    <h3 class="text-2xl font-bold text-secondary-900 mb-2">{t.title}</h3>
    <p class="text-secondary-600">{t.subtitle}</p>
  </div>

  <form id="har-idx-lead-form" class="space-y-4">
    {type !== 'newsletter' && (
      <div>
        <label class="block text-sm font-medium text-secondary-700 mb-2">
          {t.name}
        </label>
        <input
          type="text"
          required
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
        />
      </div>
    )}

    <div>
      <label class="block text-sm font-medium text-secondary-700 mb-2">
        {t.email}
      </label>
      <input
        type="email"
        required
        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
      />
    </div>

    {type === 'contact' && (
      <>
        <div>
          <label class="block text-sm font-medium text-secondary-700 mb-2">
            {t.phone}
          </label>
          <input
            type="tel"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-secondary-700 mb-2">
            {t.message}
          </label>
          <textarea
            rows="4"
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
          ></textarea>
        </div>
      </>
    )}

    {type === 'property-interest' && (
      <>
        <div>
          <label class="block text-sm font-medium text-secondary-700 mb-2">
            {t.phone}
          </label>
          <input
            type="tel"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
          />
        </div>
        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-secondary-700 mb-2">
              {t.propertyType}
            </label>
            <select class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
              <option>Single Family</option>
              <option>Condo</option>
              <option>Townhouse</option>
              <option>Multi-Family</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-secondary-700 mb-2">
              {t.priceRange}
            </label>
            <select class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
              <option>Under $200K</option>
              <option>$200K - $400K</option>
              <option>$400K - $600K</option>
              <option>$600K+</option>
            </select>
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium text-secondary-700 mb-2">
            {t.location}
          </label>
          <input
            type="text"
            placeholder="City, neighborhood, or ZIP code"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
          />
        </div>
      </>
    )}

    <button type="submit" class="btn-primary w-full">
      {t.submit}
    </button>
  </form>

  <!-- HAR IDX Lead Capture Integration -->
  <script>
    // HAR IDX form submission handler
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.querySelector('#har-idx-lead-form');
      if (form) {
        form.addEventListener('submit', function(e) {
          e.preventDefault();
          
          // Example HAR IDX API integration
          const formData = new FormData(form);
          const leadData = Object.fromEntries(formData.entries());
          
          // Demo HAR IDX lead capture (replace with your endpoint when ready)
          fetch('https://www.har.com/api/leads/capture', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'X-Account-ID': 'DEMO'
            },
            body: JSON.stringify({
              ...leadData,
              source: 'website',
              language: '{lang}',
              type: '{type}'
            })
          }).then(response => {
            if (response.ok) {
              alert('Thank you! We will contact you soon.');
              form.reset();
            }
          }).catch(error => {
            // Demo mode - show success message anyway
            alert('Demo Mode: Thank you for your interest! We will contact you soon.');
            form.reset();
          });
        });
      }
    });
  </script>
  
  <div class="mt-4 p-3 bg-purple-50 border border-purple-200 rounded-lg text-xs">
    <p class="text-purple-800 mb-1">
      <strong>Demo Mode:</strong> Form configured for demo lead capture. Replace "DEMO" with your HAR IDX account for live integration.
    </p>
    <p class="text-purple-600">
      Type: {type} | Language: {lang} | Endpoint: Ready for configuration
    </p>
  </div>
</div>
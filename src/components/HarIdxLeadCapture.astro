---
// HAR IDX Lead Capture Widget Component
export interface Props {
  lang: 'en' | 'es';
  type?: 'contact' | 'property-interest' | 'newsletter';
}

const { lang, type = 'contact' } = Astro.props;

type FormTranslations = {
  title: string;
  subtitle: string;
  name?: string;
  email: string;
  phone?: string;
  message?: string;
  propertyType?: string;
  priceRange?: string;
  location?: string;
  submit: string;
};

const translations: Record<'en' | 'es', Record<'contact' | 'property-interest' | 'newsletter', FormTranslations>> = {
  en: {
    contact: {
      title: 'Get in Touch',
      subtitle: 'Ready to find your dream home? Contact us today!',
      name: 'Full Name',
      email: 'Email Address',
      phone: 'Phone Number',
      message: 'Tell us about your property needs',
      submit: 'Send Message'
    },
    'property-interest': {
      title: 'Property Interest Form',
      subtitle: 'Let us know what you\'re looking for',
      name: 'Full Name',
      email: 'Email Address',
      phone: 'Phone Number',
      propertyType: 'Property Type',
      priceRange: 'Price Range',
      location: 'Preferred Location',
      submit: 'Find My Property'
    },
    newsletter: {
      title: 'Stay Updated',
      subtitle: 'Get the latest property listings and market insights',
      email: 'Email Address',
      submit: 'Subscribe'
    }
  },
  es: {
    contact: {
      title: 'Ponte en Contacto',
      subtitle: '¿Listo para encontrar tu hogar ideal? ¡Contáctanos hoy!',
      name: 'Nombre Completo',
      email: 'Correo Electrónico',
      phone: 'Número de Teléfono',
      message: 'Cuéntanos sobre tus necesidades inmobiliarias',
      submit: 'Enviar Mensaje'
    },
    'property-interest': {
      title: 'Formulario de Interés en Propiedades',
      subtitle: 'Cuéntanos qué estás buscando',
      name: 'Nombre Completo',
      email: 'Correo Electrónico',
      phone: 'Número de Teléfono',
      propertyType: 'Tipo de Propiedad',
      priceRange: 'Rango de Precio',
      location: 'Ubicación Preferida',
      submit: 'Encontrar Mi Propiedad'
    },
    newsletter: {
      title: 'Mantente Actualizado',
      subtitle: 'Recibe los últimos listados de propiedades e información del mercado',
      email: 'Correo Electrónico',
      submit: 'Suscribirse'
    }
  }
};

const t = translations[lang][type];
---

<div class="har-idx-lead-capture card card-padding">
  <div class="text-center mb-6">
    <h3 class="text-2xl font-bold text-secondary-900 mb-2">{t.title}</h3>
    <p class="text-secondary-600">{t.subtitle}</p>
  </div>

  <form id="har-idx-lead-form" class="space-y-4">
    {type !== 'newsletter' && (
      <div>
        <label class="block text-sm font-medium text-secondary-700 mb-2">
          {t.name}
        </label>
        <input
          type="text"
          name="name"
          required
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors"
        />
      </div>
    )}

    <div>
      <label class="block text-sm font-medium text-secondary-700 mb-2">
        {t.email}
      </label>
      <input
        type="email"
        name="email"
        required
        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors"
      />
    </div>

    {type === 'contact' && (
      <>
        <div>
          <label class="block text-sm font-medium text-secondary-700 mb-2">
            {t.phone}
          </label>
          <input
            type="tel"
            name="phone"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-secondary-700 mb-2">
            {t.message}
          </label>
          <textarea
            rows="4"
            name="message"
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors"
          ></textarea>
        </div>
      </>
    )}

    {type === 'property-interest' && (
      <>
        <div>
          <label class="block text-sm font-medium text-secondary-700 mb-2">
            {t.phone}
          </label>
          <input
            type="tel"
            name="phone"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors"
          />
        </div>
        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-secondary-700 mb-2">
              {t.propertyType}
            </label>
            <select name="propertyType" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors">
              <option>Single Family</option>
              <option>Condo</option>
              <option>Townhouse</option>
              <option>Multi-Family</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-secondary-700 mb-2">
              {t.priceRange}
            </label>
            <select name="priceRange" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors">
              <option>Under $200K</option>
              <option>$200K - $400K</option>
              <option>$400K - $600K</option>
              <option>$600K+</option>
            </select>
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium text-secondary-700 mb-2">
            {t.location}
          </label>
          <input
            type="text"
            name="location"
            placeholder="City, neighborhood, or ZIP code"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors"
          />
        </div>
      </>
    )}

    <button type="submit" class="btn-primary w-full">
      {t.submit}
    </button>
  </form>

  <!-- HAR IDX Lead Capture Integration -->
  <script>
    // HAR IDX form submission handler
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.querySelector('#har-idx-lead-form') as HTMLFormElement;
      if (form) {
        form.addEventListener('submit', function(e) {
          e.preventDefault();
          
          // Show loading state
          const submitButton = form.querySelector('button[type="submit"]') as HTMLButtonElement;
          if (!submitButton) return;
          
          const originalText = submitButton.textContent;
          submitButton.textContent = 'Sending...';
          submitButton.disabled = true;
          
          // Get form data
          const formData = new FormData(form);
          // Form data collected for potential API integration
          console.log('Form data collected:', Object.fromEntries(formData.entries()));
          
          // Simulate API call for demo mode
          setTimeout(() => {
            // Show success message
            const successDiv = document.createElement('div');
            successDiv.className = 'p-4 bg-green-100 border border-green-300 rounded-lg text-green-800 mb-4';
            successDiv.innerHTML = `
              <div class="flex items-center">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                Thank you! We will contact you soon.
              </div>
            `;
            
            if (form.parentNode) {
              form.parentNode.insertBefore(successDiv, form);
            }
            form.reset();
            
            // Reset button
            submitButton.textContent = originalText;
            submitButton.disabled = false;
            
            // Remove success message after 5 seconds
            setTimeout(() => {
              if (successDiv.parentNode) {
                successDiv.remove();
              }
            }, 5000);
          }, 1000);
        });
      }
    });
  </script>
  
  <div class="mt-4 p-3 bg-purple-50 border border-purple-200 rounded-lg text-xs">
    <p class="text-purple-800 mb-1">
      <strong>Demo Mode:</strong> Form submission is simulated for demonstration. Ready to integrate with your lead management system.
    </p>
    <p class="text-purple-600">
      Type: {type} | Language: {lang} | Status: Demo Ready
    </p>
  </div>
</div>